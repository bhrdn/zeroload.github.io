<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Secure Auth (500 pts)http://s3cur3auth.inctf.in/  Upon opening link, we’re given a false alarm for site under maintenance. Lucky enough, after visiting /robots.txt we know that there’s hidden folder">
<meta property="og:type" content="article">
<meta property="og:title" content="INCTF 2017 - Secure Auth Writeup">
<meta property="og:url" content="https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/index.html">
<meta property="og:site_name" content="Catousify">
<meta property="og:description" content="Secure Auth (500 pts)http://s3cur3auth.inctf.in/  Upon opening link, we’re given a false alarm for site under maintenance. Lucky enough, after visiting /robots.txt we know that there’s hidden folder">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://a.safe.moe/gnBnR.png">
<meta property="og:image" content="https://zeroload.github.io/img/table_1.png">
<meta property="og:updated_time" content="2018-10-16T17:54:22.645Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="INCTF 2017 - Secure Auth Writeup">
<meta name="twitter:description" content="Secure Auth (500 pts)http://s3cur3auth.inctf.in/  Upon opening link, we’re given a false alarm for site under maintenance. Lucky enough, after visiting /robots.txt we know that there’s hidden folder">
<meta name="twitter:image" content="https://a.safe.moe/gnBnR.png">
    
    
        
          
              <link rel="shortcut icon" href="/img/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>INCTF 2017 - Secure Auth Writeup</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Catousify" type="application/atom+xml" />
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/atom.xml">rss</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/02/04/sharifctf-2018-fhash-writeup/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/12/12/idsecconf-2017-online-darwin-writeup/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&text=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&is_video=false&description=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=INCTF 2017 - Secure Auth Writeup&body=Check out this article: https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&name=INCTF 2017 - Secure Auth Writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Secure-Auth-500-pts"><span class="toc-number">1.</span> <span class="toc-text">Secure Auth (500 pts)</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        INCTF 2017 - Secure Auth Writeup
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Catousify</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-12-17T16:06:26.000Z" itemprop="datePublished">2017-12-17</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<h2 id="Secure-Auth-500-pts"><a href="#Secure-Auth-500-pts" class="headerlink" title="Secure Auth (500 pts)"></a>Secure Auth (500 pts)</h2><p><a href="http://s3cur3auth.inctf.in/" target="_blank" rel="noopener">http://s3cur3auth.inctf.in/</a></p>
</blockquote>
<p>Upon opening link, we’re given a false alarm for site under maintenance. Lucky enough, after visiting /robots.txt we know that there’s hidden folder in site.</p>
<p>User-agent: *<br>Disallow: /cgi-bin<br>Disallow: /zxcv</p>
<p>This /zxcv directory could be where the challange located,</p>
<p><img src="https://a.safe.moe/gnBnR.png" alt="secure-auth-challange" title="login"> yep, that’s where the challange located.</p>
<p>After fiddling around a little bit, We know that the authentication is done within javascript, here’s the source, (truncated)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="keyword">var</span> h = $(_0xf9c2(<span class="string">'0x3'</span>))[_0xf9c2(<span class="string">'0x4'</span>)]();</span><br><span class="line">    <span class="keyword">var</span> n = h[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">    n = n[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x7'</span>)]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    n = <span class="string">'0x'</span> + n[<span class="string">'split'</span>](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x29995c =&gt; _0x29995c[_0xf9c2(<span class="string">'0x9'</span>)](<span class="number">0x0</span>)[_0xf9c2(<span class="string">'0xa'</span>)](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> m = h[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0x4</span>, <span class="number">0x8</span>);</span><br><span class="line">    m = m[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x7'</span>)]()[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    m = <span class="string">'0x'</span> + m[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x1c7b1c =&gt; _0x1c7b1c[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[_0xf9c2(<span class="string">'0xa'</span>)](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> f = h[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0x8</span>, <span class="number">0xc</span>);</span><br><span class="line">    f = f[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x7'</span>)]()[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    f = <span class="string">'0x'</span> + f[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x41acdb =&gt; _0x41acdb[_0xf9c2(<span class="string">'0x9'</span>)](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> j = h[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0xc</span>, <span class="number">0x10</span>);</span><br><span class="line">    j = j[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    j = <span class="string">'0x'</span> + j[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x4186f9 =&gt; _0x4186f9[_0xf9c2(<span class="string">'0x9'</span>)](<span class="number">0x0</span>)[_0xf9c2(<span class="string">'0xa'</span>)](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> g = h[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0x10</span>, <span class="number">0x13</span>);</span><br><span class="line">    g = g[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    g = <span class="string">'0x'</span> + g[<span class="string">'split'</span>](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x515f47 =&gt; _0x515f47[_0xf9c2(<span class="string">'0x9'</span>)](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> c = $(_0xf9c2(<span class="string">'0xc'</span>))[_0xf9c2(<span class="string">'0x4'</span>)]();</span><br><span class="line">    <span class="keyword">var</span> o = c[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">    o = o[<span class="string">'split'</span>](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x7'</span>)]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    o = <span class="string">'0x'</span> + o[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[<span class="string">'map'</span>](_0x12efcf =&gt; _0x12efcf[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[_0xf9c2(<span class="string">'0xa'</span>)](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> i = c[<span class="string">'slice'</span>](<span class="number">0x4</span>, <span class="number">0x8</span>);</span><br><span class="line">    i = i[<span class="string">'split'</span>](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x7'</span>)]()[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    i = <span class="string">'0x'</span> + i[<span class="string">'split'</span>](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x3b0ae1 =&gt; _0x3b0ae1[_0xf9c2(<span class="string">'0x9'</span>)](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> e = c[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0x8</span>, <span class="number">0xc</span>);</span><br><span class="line">    e = e[_0xf9c2(<span class="string">'0x6'</span>)](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x7'</span>)]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    e = <span class="string">'0x'</span> + e[<span class="string">'split'</span>](<span class="string">''</span>)[_0xf9c2(<span class="string">'0x8'</span>)](_0x40d2e3 =&gt; _0x40d2e3[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[_0xf9c2(<span class="string">'0xb'</span>)](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> k = c[_0xf9c2(<span class="string">'0x5'</span>)](<span class="number">0xc</span>, <span class="number">0x10</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>Uh oh.. succh obfuscate. Well, what i did was deobfuscate this by hand and here is the result,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x9c2f=[<span class="string">'PROT_ALL'</span>,<span class="string">'location'</span>,<span class="string">'href'</span>,<span class="string">'indexOf'</span>,<span class="string">'/../'</span>,<span class="string">'.html'</span>,<span class="string">'Wrong\x20credentials,\x20sorry'</span>,<span class="string">'#c_submit'</span>,<span class="string">'click'</span>,<span class="string">'preventDefault'</span>,<span class="string">'#cuser'</span>,<span class="string">'val'</span>,<span class="string">'slice'</span>,<span class="string">'split'</span>,<span class="string">'reverse'</span>,<span class="string">'map'</span>,<span class="string">'charCodeAt'</span>,<span class="string">'toString'</span>,<span class="string">'join'</span>,<span class="string">'#cpass'</span>,<span class="string">'reg_write_i32'</span>,<span class="string">'X86_REG_EAX'</span>,<span class="string">'X86_REG_ECX'</span>,<span class="string">'X86_REG_EDX'</span>,<span class="string">'mem_map'</span>,<span class="string">'emu_start'</span>,<span class="string">'length'</span>,<span class="string">'reg_read_i32'</span>,<span class="string">'ARCH_X86'</span>,<span class="string">'MODE_32'</span>,<span class="string">'X86_REG_ESI'</span>,<span class="string">'X86_REG_EBX'</span>,<span class="string">'X86_REG_EBP'</span>];</span><br><span class="line">(function(a, c)&#123;</span><br><span class="line">    <span class="keyword">var</span> b = function(b) &#123;</span><br><span class="line">        <span class="keyword">while</span> (--b) &#123;</span><br><span class="line">            a[<span class="string">'push'</span>](a[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    b(++c);</span><br><span class="line">&#125;(_0x9c2f, <span class="number">0x193</span>));</span><br><span class="line"><span class="keyword">var</span> _0xf9c2 = function(a, c) &#123;</span><br><span class="line">    a = a - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> b = _0x9c2f[a];</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;;</span><br><span class="line">$(<span class="string">'#c_submit'</span>)[<span class="string">'click'</span>](function(r)&#123;</span><br><span class="line">    r[<span class="string">'preventDefault'</span>]();</span><br><span class="line">    <span class="keyword">var</span> h = $(<span class="string">'#cuser'</span>)[<span class="string">'val'</span>]();</span><br><span class="line">    <span class="keyword">var</span> n = h[<span class="string">'slice'</span>](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">    n = n[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    n = <span class="string">'0x'</span> + n[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x29995c =&gt; _0x29995c[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> m = h[<span class="string">'slice'</span>](<span class="number">0x4</span>, <span class="number">0x8</span>);</span><br><span class="line">    m = m[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    m = <span class="string">'0x'</span> + m[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x1c7b1c =&gt; _0x1c7b1c[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> f = h[<span class="string">'slice'</span>](<span class="number">0x8</span>, <span class="number">0xc</span>);</span><br><span class="line">    f = f[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    f = <span class="string">'0x'</span> + f[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x41acdb =&gt; _0x41acdb[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> j = h[<span class="string">'slice'</span>](<span class="number">0xc</span>, <span class="number">0x10</span>);</span><br><span class="line">    j = j[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    j = <span class="string">'0x'</span> + j[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x4186f9 =&gt; _0x4186f9[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> g = h[<span class="string">'slice'</span>](<span class="number">0x10</span>, <span class="number">0x13</span>);</span><br><span class="line">    g = g[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    g = <span class="string">'0x'</span> + g[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x515f47 =&gt; _0x515f47[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> c = $(<span class="string">'#cpass'</span>)[<span class="string">'val'</span>]();</span><br><span class="line">    <span class="keyword">var</span> o = c[<span class="string">'slice'</span>](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">    o = o[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    o = <span class="string">'0x'</span> + o[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x12efcf =&gt; _0x12efcf[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> i = c[<span class="string">'slice'</span>](<span class="number">0x4</span>, <span class="number">0x8</span>);</span><br><span class="line">    i = i[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    i = <span class="string">'0x'</span> + i[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x3b0ae1 =&gt; _0x3b0ae1[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> e = c[<span class="string">'slice'</span>](<span class="number">0x8</span>, <span class="number">0xc</span>);</span><br><span class="line">    e = e[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    e = <span class="string">'0x'</span> + e[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x40d2e3 =&gt; _0x40d2e3[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> k = c[<span class="string">'slice'</span>](<span class="number">0xc</span>, <span class="number">0x10</span>);</span><br><span class="line">    k = k[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    k = <span class="string">'0x'</span> + k[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x71ef00 =&gt; _0x71ef00[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> l = c[<span class="string">'slice'</span>](<span class="number">0x10</span>, <span class="number">0x13</span>);</span><br><span class="line">    l = l[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'reverse'</span>]()[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    l = <span class="string">'0x'</span> + l[<span class="string">'split'</span>](<span class="string">''</span>)[<span class="string">'map'</span>](_0x335224 =&gt; _0x335224[<span class="string">'charCodeAt'</span>](<span class="number">0x0</span>)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'join'</span>](<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">var</span> a = <span class="keyword">new</span> uc[<span class="string">'Unicorn'</span>](uc[<span class="string">'ARCH_X86'</span>], uc[<span class="string">'MODE_32'</span>]);</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">0x8048000</span>;</span><br><span class="line">    <span class="keyword">var</span> d = [<span class="number">0xbf</span>, <span class="number">0x69</span>, <span class="number">0x61</span>, <span class="number">0x6d</span>, <span class="number">0x74</span>, <span class="number">0x39</span>, <span class="number">0xf8</span>, <span class="number">0x75</span>, <span class="number">0x2b</span>, <span class="number">0xbf</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x39</span>, <span class="number">0xfb</span>, <span class="number">0x75</span>, <span class="number">0x22</span>, <span class="number">0xbf</span>, <span class="number">0x6d</span>, <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x69</span>, <span class="number">0x39</span>, <span class="number">0xf9</span>, <span class="number">0x75</span>, <span class="number">0x19</span>, <span class="number">0xbf</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0x39</span>, <span class="number">0xfa</span>, <span class="number">0x75</span>, <span class="number">0x10</span>, <span class="number">0xbf</span>, <span class="number">0x74</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x0</span>, <span class="number">0x39</span>, <span class="number">0xfe</span>, <span class="number">0x75</span>, <span class="number">0x7</span>, <span class="number">0xb8</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xeb</span>, <span class="number">0x5</span>, <span class="number">0xb8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>];</span><br><span class="line">    a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EAX'</span>], n);</span><br><span class="line">    a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EBX'</span>], m);</span><br><span class="line">    a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_ECX'</span>], f);</span><br><span class="line">    a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EDX'</span>], j);</span><br><span class="line">    a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_ESI'</span>], g);</span><br><span class="line">    a[<span class="string">'mem_map'</span>](b, <span class="number">0x1000</span>, uc[<span class="string">'PROT_ALL'</span>]);</span><br><span class="line">    a[<span class="string">'mem_write'</span>](b, d);</span><br><span class="line">    a[<span class="string">'emu_start'</span>](b, b + d[<span class="string">'PROT_ALL'</span>]);</span><br><span class="line">    <span class="keyword">var</span> p = a[<span class="string">'reg_read_i32'</span>](uc[<span class="string">'X86_REG_EAX'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (p) &#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="keyword">new</span> uc[<span class="string">'Unicorn'</span>](uc[<span class="string">'ARCH_X86'</span>], uc[<span class="string">'MODE_32'</span>]);</span><br><span class="line">        <span class="keyword">var</span> b = <span class="number">0x8048000</span>;</span><br><span class="line">        <span class="keyword">var</span> d = [<span class="number">0x81</span>, <span class="number">0xc6</span>, <span class="number">0x69</span>, <span class="number">0x61</span>, <span class="number">0x6d</span>, <span class="number">0x74</span>, <span class="number">0x81</span>, <span class="number">0xc6</span>, <span class="number">0x7</span>, <span class="number">0x6</span>, <span class="number">0x5</span>, <span class="number">0x4</span>, <span class="number">0x81</span>, <span class="number">0xfe</span>, <span class="number">0xd3</span>, <span class="number">0xd6</span>, <span class="number">0xe0</span>, <span class="number">0xdf</span>, <span class="number">0x75</span>, <span class="number">0x55</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc3</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x81</span>, <span class="number">0xc3</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x81</span>, <span class="number">0xfb</span>, <span class="number">0xdd</span>, <span class="number">0xdb</span>, <span class="number">0xdc</span>, <span class="number">0x98</span>, <span class="number">0x75</span>, <span class="number">0x40</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc1</span>, <span class="number">0x6d</span>, <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x69</span>, <span class="number">0x81</span>, <span class="number">0xc1</span>, <span class="number">0xf</span>, <span class="number">0xe</span>, <span class="number">0xd</span>, <span class="number">0xc</span>, <span class="number">0x81</span>, <span class="number">0xf9</span>, <span class="number">0xf0</span>, <span class="number">0xdf</span>, <span class="number">0xe0</span>, <span class="number">0xe5</span>, <span class="number">0x75</span>, <span class="number">0x2b</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc2</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0x81</span>, <span class="number">0xc2</span>, <span class="number">0xb</span>, <span class="number">0xa</span>, <span class="number">0x9</span>, <span class="number">0x8</span>, <span class="number">0x81</span>, <span class="number">0xfa</span>, <span class="number">0xdf</span>, <span class="number">0xf1</span>, <span class="number">0x9f</span>, <span class="number">0xe0</span>, <span class="number">0x75</span>, <span class="number">0x16</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc5</span>, <span class="number">0x74</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x0</span>, <span class="number">0x81</span>, <span class="number">0xc5</span>, <span class="number">0x17</span>, <span class="number">0x16</span>, <span class="number">0x15</span>, <span class="number">0x0</span>, <span class="number">0x81</span>, <span class="number">0xfd</span>, <span class="number">0xbb</span>, <span class="number">0xf7</span>, <span class="number">0xcb</span>, <span class="number">0x0</span>, <span class="number">0x75</span>, <span class="number">0x1</span>, <span class="number">0x40</span>];</span><br><span class="line">        a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_ESI'</span>], o);</span><br><span class="line">        a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EBX'</span>], i);</span><br><span class="line">        a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_ECX'</span>], e);</span><br><span class="line">        a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EDX'</span>], k);</span><br><span class="line">        a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EBP'</span>], l);</span><br><span class="line">        a[<span class="string">'mem_map'</span>](b, <span class="number">0x1000</span>, uc[<span class="string">'PROT_ALL'</span>]);</span><br><span class="line">        a[<span class="string">'mem_write'</span>](b, d);</span><br><span class="line">        a[<span class="string">'emu_start'</span>](b, b + d[<span class="string">'length'</span>]);</span><br><span class="line">        <span class="keyword">var</span> q = a[<span class="string">'reg_read_i32'</span>](uc[<span class="string">'X86_REG_EAX'</span>]);</span><br><span class="line">        <span class="keyword">if</span> (q == <span class="number">0x5</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (document[<span class="string">'location'</span>][<span class="string">'href'</span>][<span class="string">'indexOf'</span>](<span class="string">'?p='</span>) == -<span class="number">0x1</span>) &#123;</span><br><span class="line">                document[<span class="string">'location'</span>] = document[<span class="string">'location'</span>] + <span class="string">'/../'</span> + c + <span class="string">'.html'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(<span class="string">'Wrong credentials, sorry'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(<span class="string">'Wrong credentials, sorry'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The next stage, analysis part. (1st) There are 2 input, username in #cuser and password in #cpass. The input is 0x13 bytes long sliced into 5 part and 3-4 bytes each in little endian.</p>
<p><img src="/img/table_1.png" alt=""></p>
<p>The authentication uses Unicorn to emulate shellcode in browser.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var a = new uc[&apos;Unicorn&apos;](uc[&apos;ARCH_X86&apos;], uc[&apos;MODE_32&apos;]);</span><br><span class="line">    var b = 0x8048000;</span><br><span class="line">    var d = [0xbf, 0x69, 0x61, 0x6d, 0x74, 0x39, 0xf8, 0x75, 0x2b, 0xbf, 0x68, 0x65, 0x61, 0x64, 0x39, 0xfb, 0x75, 0x22, 0xbf, 0x6d, 0x69, 0x6e, 0x69, 0x39, 0xf9, 0x75, 0x19, 0xbf, 0x73, 0x74, 0x72, 0x61, 0x39, 0xfa, 0x75, 0x10, 0xbf, 0x74, 0x6f, 0x72, 0x0, 0x39, 0xfe, 0x75, 0x7, 0xb8, 0x1, 0x0, 0x0, 0x0, 0xeb, 0x5, 0xb8, 0x0, 0x0, 0x0, 0x0];</span><br><span class="line">    a[&apos;reg_write_i32&apos;](uc[&apos;X86_REG_EAX&apos;], n);</span><br><span class="line">    a[&apos;reg_write_i32&apos;](uc[&apos;X86_REG_EBX&apos;], m);</span><br><span class="line">    a[&apos;reg_write_i32&apos;](uc[&apos;X86_REG_ECX&apos;], f);</span><br><span class="line">    a[&apos;reg_write_i32&apos;](uc[&apos;X86_REG_EDX&apos;], j);</span><br><span class="line">    a[&apos;reg_write_i32&apos;](uc[&apos;X86_REG_ESI&apos;], g);</span><br><span class="line">    a[&apos;mem_map&apos;](b, 0x1000, uc[&apos;PROT_ALL&apos;]);</span><br><span class="line">    a[&apos;mem_write&apos;](b, d);</span><br><span class="line">    a[&apos;emu_start&apos;](b, b + d[&apos;PROT_ALL&apos;]);</span><br><span class="line">    var p = a[&apos;reg_read_i32&apos;](uc[&apos;X86_REG_EAX&apos;]);</span><br></pre></td></tr></table></figure></p>
<p>(2nd) This is the first part of auth checker to check username input. <code>n, m, f, j, g</code> are values from sliced #cuser input. From that we know,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">n = &gt; EAX</span><br><span class="line">m =&gt; EBX</span><br><span class="line">f =&gt; ECX</span><br><span class="line">j =&gt; EDX</span><br><span class="line">g =&gt; ESI</span><br></pre></td></tr></table></figure>
<p>The shellcode part,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 0:   bf 69 61 6d 74          mov    edi,0x746d6169</span><br><span class="line"> 5:   39 f8                   cmp    eax,edi</span><br><span class="line"> 7:   75 2b                   jne    0x34</span><br><span class="line"> 9:   bf 68 65 61 64          mov    edi,0x64616568</span><br><span class="line"> e:   39 fb                   cmp    ebx,edi</span><br><span class="line">10:   75 22                   jne    0x34</span><br><span class="line">12:   bf 6d 69 6e 69          mov    edi,0x696e696d</span><br><span class="line">17:   39 f9                   cmp    ecx,edi</span><br><span class="line">19:   75 19                   jne    0x34</span><br><span class="line">1b:   bf 73 74 72 61          mov    edi,0x61727473</span><br><span class="line">20:   39 fa                   cmp    edx,edi</span><br><span class="line">22:   75 10                   jne    0x34</span><br><span class="line">24:   bf 74 6f 72 00          mov    edi,0x726f74</span><br><span class="line">29:   39 fe                   cmp    esi,edi</span><br><span class="line">2b:   75 07                   jne    0x34</span><br><span class="line">2d:   b8 01 00 00 00          mov    eax,0x1</span><br><span class="line">32:   eb 05                   jmp    0x39</span><br><span class="line">34:   b8 00 00 00 00          mov    eax,0x0</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x746d6169 == EAX</span><br><span class="line">0x64616568 == EBX</span><br><span class="line">0x696e696d == ECX</span><br><span class="line">0x61727473 == EDX</span><br><span class="line">0x726f74 == ESI</span><br></pre></td></tr></table></figure>
<p>Thats clear enough, the values <code>n, m, f, j, g</code> should be <code>&quot;iamt&quot;, &quot;head&quot;, &quot;mini&quot;, &quot;stra&quot;, &quot;tor&quot;</code>. <strong>#cuser == iamtheadministrator</strong>. (3rd) Next one, the checker for #cpass.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> uc[<span class="string">'Unicorn'</span>](uc[<span class="string">'ARCH_X86'</span>], uc[<span class="string">'MODE_32'</span>]);</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">0x8048000</span>;</span><br><span class="line"><span class="keyword">var</span> d = [<span class="number">0x81</span>, <span class="number">0xc6</span>, <span class="number">0x69</span>, <span class="number">0x61</span>, <span class="number">0x6d</span>, <span class="number">0x74</span>, <span class="number">0x81</span>, <span class="number">0xc6</span>, <span class="number">0x7</span>, <span class="number">0x6</span>, <span class="number">0x5</span>, <span class="number">0x4</span>, <span class="number">0x81</span>, <span class="number">0xfe</span>, <span class="number">0xd3</span>, <span class="number">0xd6</span>, <span class="number">0xe0</span>, <span class="number">0xdf</span>, <span class="number">0x75</span>, <span class="number">0x55</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc3</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x81</span>, <span class="number">0xc3</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x81</span>, <span class="number">0xfb</span>, <span class="number">0xdd</span>, <span class="number">0xdb</span>, <span class="number">0xdc</span>, <span class="number">0x98</span>, <span class="number">0x75</span>, <span class="number">0x40</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc1</span>, <span class="number">0x6d</span>, <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x69</span>, <span class="number">0x81</span>, <span class="number">0xc1</span>, <span class="number">0xf</span>, <span class="number">0xe</span>, <span class="number">0xd</span>, <span class="number">0xc</span>, <span class="number">0x81</span>, <span class="number">0xf9</span>, <span class="number">0xf0</span>, <span class="number">0xdf</span>, <span class="number">0xe0</span>, <span class="number">0xe5</span>, <span class="number">0x75</span>, <span class="number">0x2b</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc2</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0x81</span>, <span class="number">0xc2</span>, <span class="number">0xb</span>, <span class="number">0xa</span>, <span class="number">0x9</span>, <span class="number">0x8</span>, <span class="number">0x81</span>, <span class="number">0xfa</span>, <span class="number">0xdf</span>, <span class="number">0xf1</span>, <span class="number">0x9f</span>, <span class="number">0xe0</span>, <span class="number">0x75</span>, <span class="number">0x16</span>, <span class="number">0x40</span>, <span class="number">0x81</span>, <span class="number">0xc5</span>, <span class="number">0x74</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x0</span>, <span class="number">0x81</span>, <span class="number">0xc5</span>, <span class="number">0x17</span>, <span class="number">0x16</span>, <span class="number">0x15</span>, <span class="number">0x0</span>, <span class="number">0x81</span>, <span class="number">0xfd</span>, <span class="number">0xbb</span>, <span class="number">0xf7</span>, <span class="number">0xcb</span>, <span class="number">0x0</span>, <span class="number">0x75</span>, <span class="number">0x1</span>, <span class="number">0x40</span>];</span><br><span class="line">a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_ESI'</span>], o);</span><br><span class="line">a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EBX'</span>], i);</span><br><span class="line">a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_ECX'</span>], e);</span><br><span class="line">a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EDX'</span>], k);</span><br><span class="line">a[<span class="string">'reg_write_i32'</span>](uc[<span class="string">'X86_REG_EBP'</span>], l);</span><br><span class="line">a[<span class="string">'mem_map'</span>](b, <span class="number">0x1000</span>, uc[<span class="string">'PROT_ALL'</span>]);</span><br><span class="line">a[<span class="string">'mem_write'</span>](b, d);</span><br><span class="line">a[<span class="string">'emu_start'</span>](b, b + d[<span class="string">'length'</span>]);</span><br><span class="line"><span class="keyword">var</span> q = a[<span class="string">'reg_read_i32'</span>](uc[<span class="string">'X86_REG_EAX'</span>]);</span><br></pre></td></tr></table></figure>
<p><code>o, i, e, k, l</code> are values from sliced #cpass input. From that we know,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">o =&gt; ESI</span><br><span class="line">i =&gt; EBX</span><br><span class="line">e =&gt; ECX</span><br><span class="line">k =&gt; EDX</span><br><span class="line">l =&gt; EBP</span><br></pre></td></tr></table></figure>
<p>The shellcode part,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> 0:   81 c6 69 61 6d 74       add    esi,0x746d6169</span><br><span class="line"> 6:   81 c6 07 06 05 04       add    esi,0x4050607</span><br><span class="line"> c:   81 fe d3 d6 e0 df       cmp    esi,0xdfe0d6d3</span><br><span class="line">12:   75 55                   jne    0x69</span><br><span class="line">14:   40                      inc    eax</span><br><span class="line">15:   81 c3 68 65 61 64       add    ebx,0x64616568</span><br><span class="line">1b:   81 c3 03 02 01 00       add    ebx,0x10203</span><br><span class="line">21:   81 fb dd db dc 98       cmp    ebx,0x98dcdbdd</span><br><span class="line">27:   75 40                   jne    0x69</span><br><span class="line">29:   40                      inc    eax</span><br><span class="line">2a:   81 c1 6d 69 6e 69       add    ecx,0x696e696d</span><br><span class="line">30:   81 c1 0f 0e 0d 0c       add    ecx,0xc0d0e0f</span><br><span class="line">36:   81 f9 f0 df e0 e5       cmp    ecx,0xe5e0dff0</span><br><span class="line">3c:   75 2b                   jne    0x69</span><br><span class="line">3e:   40                      inc    eax</span><br><span class="line">3f:   81 c2 73 74 72 61       add    edx,0x61727473</span><br><span class="line">45:   81 c2 0b 0a 09 08       add    edx,0x8090a0b</span><br><span class="line">4b:   81 fa df f1 9f e0       cmp    edx,0xe09ff1df</span><br><span class="line">51:   75 16                   jne    0x69</span><br><span class="line">53:   40                      inc    eax</span><br><span class="line">54:   81 c5 74 6f 72 00       add    ebp,0x726f74</span><br><span class="line">5a:   81 c5 17 16 15 00       add    ebp,0x151617</span><br><span class="line">60:   81 fd bb f7 cb 00       cmp    ebp,0xcbf7bb</span><br><span class="line">66:   75 01                   jne    0x69</span><br><span class="line">68:   40                      inc    eax</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0xdfe0d6d3 == ESI + 0x746d6169 + 0x4050607</span><br><span class="line">0x98dcdbdd == EBX + 0x64616568 + 0x10203</span><br><span class="line">0xe5e0dff0 == ECX + 0x696e696d + 0xc0d0e0f</span><br><span class="line">0xe09ff1df == EDX + 0x61727473 + 0x8090a0b</span><br><span class="line">0xcbf7bb   == ESI + 0x726f74 + 0x151617</span><br></pre></td></tr></table></figure>
<p>Reversing the values by subtracting, we have the values what we wanted. <code>o, i, e, k, l</code> should be <code>&quot;cong&quot;, &quot;rtz4&quot;, &quot;thep&quot;, &quot;as$w&quot;, &quot;0rD&quot;</code>. <code>#cpass == congrtz4thepas$w0rD</code> To sum it up, we have the value for <code>#cuser == &#39;iamtheadministrator&#39;</code> and <code>#cpass == &#39;congrtz4thepas$w0rD&#39;</code>. After submit that values, it’ll be redirected to flag page, and we got the flag.</p>
<p>FLAG : <code>inctf{l1ck_l1ck_l1ck_my_j5}</code></p>
<hr>
<p>Side note, This event has many cool challanges. I liked this one actually, since this is a mix for web and reversing challange (read: I get the firstblood for this challange :p). I couldn’t get any flag for advanced binary challange tho. The mobile challange looks like have many flaw and unintended ways of for solving. I’m expecting it to have some anti-tamper but just by small patching anyone could get the flag.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/atom.xml">rss</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Secure-Auth-500-pts"><span class="toc-number">1.</span> <span class="toc-text">Secure Auth (500 pts)</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&text=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&is_video=false&description=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=INCTF 2017 - Secure Auth Writeup&body=Check out this article: https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&title=INCTF 2017 - Secure Auth Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://zeroload.github.io/2017/12/17/inctf-2017-secure-auth-writeup/&name=INCTF 2017 - Secure Auth Writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 zeroload
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/atom.xml">rss</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'zeroload-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


