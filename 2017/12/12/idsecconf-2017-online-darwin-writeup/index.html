<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Darwin (??? pts) Download Reverse Engineering Mach-O executable  Diberikan sebuah binary Mach-O 32bit, langsung ke analisa binarynya 1234567891011121314151617181920212223242526272829signed int start(">
<meta property="og:type" content="article">
<meta property="og:title" content="IDSECCONF 2017 Online - Darwin Writeup">
<meta property="og:url" content="https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/index.html">
<meta property="og:site_name" content="Catousify">
<meta property="og:description" content="Darwin (??? pts) Download Reverse Engineering Mach-O executable  Diberikan sebuah binary Mach-O 32bit, langsung ke analisa binarynya 1234567891011121314151617181920212223242526272829signed int start(">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-10-16T17:54:22.645Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IDSECCONF 2017 Online - Darwin Writeup">
<meta name="twitter:description" content="Darwin (??? pts) Download Reverse Engineering Mach-O executable  Diberikan sebuah binary Mach-O 32bit, langsung ke analisa binarynya 1234567891011121314151617181920212223242526272829signed int start(">
    
    
        
          
              <link rel="shortcut icon" href="/img/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>IDSECCONF 2017 Online - Darwin Writeup</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Catousify" type="application/atom+xml" />
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/atom.xml">rss</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/12/17/inctf-2017-secure-auth-writeup/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/12/11/seccon-2017-powerful-shell-writeup/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&text=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&is_video=false&description=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=IDSECCONF 2017 Online - Darwin Writeup&body=Check out this article: https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&name=IDSECCONF 2017 Online - Darwin Writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        IDSECCONF 2017 Online - Darwin Writeup
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Catousify</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-12-12T13:02:30.000Z" itemprop="datePublished">2017-12-12</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>Darwin (??? pts) <a href="https://a.safe.moe/Ph9RJ.zip" target="_blank" rel="noopener">Download</a> Reverse Engineering Mach-O executable</p>
</blockquote>
<p>Diberikan sebuah binary Mach-O 32bit, langsung ke analisa binarynya</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v0; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+44h] [ebp-44h]</span></span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">32</span>]; <span class="comment">// [esp+58h] [ebp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+78h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v3, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter the key : "</span>);</span><br><span class="line">  fflush(__stdoutp);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  fgets(v3, <span class="number">32</span>, __stdinp);</span><br><span class="line">  <span class="keyword">while</span> ( v2 &lt; <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v3[v2] == <span class="number">10</span> )</span><br><span class="line">      v0 = <span class="number">-10</span>;</span><br><span class="line">    v3[v2++] += v0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( sub_1A30((<span class="keyword">int</span>)v3) )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Congratz, the flag :\\nflag&#123;yOu_%s_3v3r&#125;\\n"</span>, v3);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Wrong %s not the key.\\n"</span>, v3);</span><br><span class="line">  result = <span class="number">7566</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __stack_chk_guard == v4 )</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Intinya, program meminta input dan melakukan pengecekan input pada fungsi sub_1A30.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">BOOL __<span class="function">cdecl <span class="title">sub_1A30</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+1Ch] [ebp-5Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+20h] [ebp-58h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+2Ch] [ebp-4Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+30h] [ebp-48h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+34h] [ebp-44h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+38h] [ebp-40h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> k; <span class="comment">// [esp+40h] [ebp-38h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [esp+44h] [ebp-34h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+48h] [ebp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [esp+4Ch] [ebp-2Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [esp+50h] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [esp+54h] [ebp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [esp+58h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+5Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+60h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [esp+64h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v18; <span class="comment">// [esp+68h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">  v18 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)a1);</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v18; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">2</span> )</span><br><span class="line">      v7 = *(<span class="keyword">char</span> *)(a1 + i) ^ v14;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v7 = v14;</span><br><span class="line">    v14 = v7;</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">      v6 = v13;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v6 = *(<span class="keyword">char</span> *)(a1 + i) ^ v13;</span><br><span class="line">    v13 = v6;</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">2</span> )</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = *(<span class="keyword">char</span> *)(a1 + i);</span><br><span class="line">    v17 += v5;</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">      v4 = *(<span class="keyword">char</span> *)(a1 + i) ^ v15;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = v15;</span><br><span class="line">    v15 = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v18 / <span class="number">2</span>; ++j )</span><br><span class="line">    v12 ^= *(<span class="keyword">char</span> *)(a1 + j);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v18; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( k % <span class="number">2</span> )</span><br><span class="line">      v3 = *(<span class="keyword">char</span> *)(a1 + k);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">    v16 += v3;</span><br><span class="line">    <span class="keyword">if</span> ( k % <span class="number">2</span> )</span><br><span class="line">      v2 = v15;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v2 = *(<span class="keyword">char</span> *)(a1 + k) ^ v15;</span><br><span class="line">    v15 = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  v11 = sub_19C0(a1);</span><br><span class="line">  <span class="keyword">return</span> v17 % <span class="number">10</span> == <span class="number">8</span></span><br><span class="line">      &amp;&amp; v16 % <span class="number">10</span> == v17 % <span class="number">10</span></span><br><span class="line">      &amp;&amp; v18 == <span class="number">13</span></span><br><span class="line">      &amp;&amp; v15 == <span class="number">90</span></span><br><span class="line">      &amp;&amp; v12 == <span class="number">21</span></span><br><span class="line">      &amp;&amp; v14 == <span class="number">56</span></span><br><span class="line">      &amp;&amp; (v16 + v17) / <span class="number">10</span> == <span class="number">116</span></span><br><span class="line">      &amp;&amp; (v16 + <span class="number">2</span> * v17) / <span class="number">10</span> == <span class="number">183</span></span><br><span class="line">      &amp;&amp; *(_BYTE *)(a1 + <span class="number">1</span>) == <span class="string">'3'</span></span><br><span class="line">      &amp;&amp; *(_BYTE *)(a1 + <span class="number">5</span>) == <span class="string">'5'</span></span><br><span class="line">      &amp;&amp; *(_BYTE *)(a1 + <span class="number">8</span>) == <span class="string">'4'</span></span><br><span class="line">      &amp;&amp; *(_BYTE *)(a1 + <span class="number">10</span>) == <span class="string">'7'</span></span><br><span class="line">      &amp;&amp; v11 == <span class="number">0xFD4E6A44</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dapat diketahui, panjang string input harus 13 karakter, dan input[1] == ‘3’, input[5] == ‘5’, input[8] == ‘4’, input[10] == ‘7’.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v18 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)a1);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> ... &amp;&amp; v18 == <span class="number">13</span></span><br><span class="line">... </span><br><span class="line">&amp;&amp; *(_BYTE *)(a1 + <span class="number">1</span>) == <span class="string">'3'</span></span><br><span class="line">&amp;&amp; *(_BYTE *)(a1 + <span class="number">5</span>) == <span class="string">'5'</span></span><br><span class="line">&amp;&amp; *(_BYTE *)(a1 + <span class="number">8</span>) == <span class="string">'4'</span></span><br><span class="line">&amp;&amp; *(_BYTE *)(a1 + <span class="number">10</span>) == <span class="string">'7'</span></span><br></pre></td></tr></table></figure>
<p>Nah, selebihnya dapat dianalisa lebih lanjut pada 3 loop-for di dapat,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v12 = input[0] ^ input[1] ^ input[2] ^ input[3] ^ input[4] ^ input[5]</span><br><span class="line">v14 = input[1] ^ input[3] ^ input[5] ^ input[7] ^ input[9] ^ input[11]</span><br><span class="line">v15 = input[0] ^ input[1] ^ input[2] ^ input[3] ^ input[4] ^ input[5] ^ input[6] ^ input[7] ^ input[8] ^ input[9] ^ input[10] ^ input[11] ^ input[12]</span><br><span class="line">v12 == 21</span><br><span class="line">v14 == 56</span><br><span class="line">v15 == 90</span><br><span class="line"></span><br><span class="line">v16 = input[0] + input[2] + input[4] + input[6] + input[8] + input[10] + input[12]</span><br><span class="line">v17 = input[1] + input[3] + input[5] + input[7] + input[9] + input[11]</span><br><span class="line">v17 % 10 == 8</span><br><span class="line">v16 % 10 == v17 % 10</span><br><span class="line">(v16 + v17) / 10 == 116</span><br><span class="line">(v16 + 2 * v17) / 10 == 183</span><br></pre></td></tr></table></figure>
<p>Nah, untuk mengetahui value pasti dari v17 dan v16 bisa dihitung manual,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v17 = ??8</span><br><span class="line">v16 = ??8</span><br><span class="line">...</span><br><span class="line">v16 + 17 = 1166</span><br><span class="line">v16 + 2*v17 = 1834</span><br><span class="line">...</span><br><span class="line">v16 == 668</span><br><span class="line">v17 == 498</span><br></pre></td></tr></table></figure>
<p>Lanjut untuk analisa value dari v11,</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_19C0</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+10h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v3 = <span class="number">23</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">    v3 = (a1[i] &lt;&lt; i) + <span class="number">7</span> * v3;   <span class="keyword">return</span> v3 &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ugh.. konstrain untuk flag sudah makin ribet. Langsung aja ke intinya, soal-soal tipe seperti ini bisa digunakan SMT solver seperti z3 dengan menambahkan constaraint-constaraint diatas, berikut kodenya</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">str = [BitVec(i, <span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">13</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> str:</span><br><span class="line">    s.add(x &gt;= <span class="number">0x20</span>, x &lt;= <span class="number">0x7e</span>)</span><br><span class="line"></span><br><span class="line">s.add(str[<span class="number">1</span>] == ord(<span class="string">'3'</span>))</span><br><span class="line">s.add(str[<span class="number">5</span>] == ord(<span class="string">'5'</span>))</span><br><span class="line">s.add(str[<span class="number">8</span>] == ord(<span class="string">'4'</span>))</span><br><span class="line">s.add(str[<span class="number">10</span>] == ord(<span class="string">'7'</span>))</span><br><span class="line"></span><br><span class="line">s.add(str[<span class="number">0</span>] ^ str[<span class="number">1</span>] ^ str[<span class="number">2</span>] ^ str[<span class="number">3</span>] ^ str[<span class="number">4</span>] ^ str[<span class="number">5</span>] == <span class="number">21</span>)</span><br><span class="line">s.add(str[<span class="number">0</span>] ^ str[<span class="number">1</span>] ^ str[<span class="number">2</span>] ^ str[<span class="number">3</span>] ^ str[<span class="number">4</span>] ^ str[<span class="number">5</span>] ^ str[<span class="number">6</span>] ^ str[<span class="number">7</span>] ^ str[<span class="number">8</span>] ^ str[<span class="number">9</span>] ^ str[<span class="number">10</span>] ^ str[<span class="number">11</span>] ^ str[<span class="number">12</span>] == <span class="number">90</span>)</span><br><span class="line">s.add(str[<span class="number">1</span>] ^ str[<span class="number">3</span>] ^ str[<span class="number">5</span>] ^ str[<span class="number">7</span>] ^ str[<span class="number">9</span>] ^ str[<span class="number">11</span>] == <span class="number">56</span>)</span><br><span class="line"></span><br><span class="line">s.add(str[<span class="number">0</span>] + str[<span class="number">2</span>] + str[<span class="number">4</span>] + str[<span class="number">6</span>] + str[<span class="number">8</span>] + str[<span class="number">10</span>] + str[<span class="number">12</span>] == <span class="number">668</span>)</span><br><span class="line">s.add(str[<span class="number">1</span>] + str[<span class="number">3</span>] + str[<span class="number">5</span>] + str[<span class="number">7</span>] + str[<span class="number">9</span>] + str[<span class="number">11</span>] == <span class="number">498</span>)</span><br><span class="line"></span><br><span class="line">v3 = <span class="number">23</span></span><br><span class="line"><span class="keyword">for</span> i, char <span class="keyword">in</span> enumerate(str):</span><br><span class="line">    v3 = ((char &lt;&lt; i) + <span class="number">7</span> * v3) &amp; <span class="number">0xffffffff</span> v3 = (v3 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">s.add(v3 == <span class="number">0xFD4E6A44</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    flag = [chr(model[x].as_long()) <span class="keyword">for</span> x <span class="keyword">in</span> str]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">''</span>.join(flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Nope :('</span></span><br></pre></td></tr></table></figure>
<p>Jalankan kodenya, didapatkan flag,</p>
<p>FLAG : <code>flag{yOu_r3ver5eM4s7er_3v3r}</code></p>
<hr>
<p>Side note: tbh ini ngerjainnya semalam suntuk. Hanya karena tidak menggunakan python2 waktu mengerjakan. Kenapa pengaruh banget? Iya, ini serius, vm ctfbox yang dipakai default python diubah ke python3 dan entah kenapa pas menjalankan kodingan diatas selalu return unsatisfied :(. Udah beberapa jam tapi gak sadar juga, sampai akhirnya coba pakai python2 dan output dapat satisfied (yeay). Whats learned? Coba-coba baca issues di github kalau nge-stuck. Pakai python2 buat solve sesuatu berhubungan dengan z3/SMT solver lain. Original idea by Bang Alfan (<a href="http://maulvi-cs.blogspot.com/)" target="_blank" rel="noopener">http://maulvi-cs.blogspot.com/)</a>.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/atom.xml">rss</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&text=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&is_video=false&description=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=IDSECCONF 2017 Online - Darwin Writeup&body=Check out this article: https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&title=IDSECCONF 2017 Online - Darwin Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://zeroload.github.io/2017/12/12/idsecconf-2017-online-darwin-writeup/&name=IDSECCONF 2017 Online - Darwin Writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 zeroload
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/atom.xml">rss</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'zeroload-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


